<!DOCTYPE html>
<html lang="en" class="light">
  <head>
    <!DOCTYPE html>
    <html lang="en" class="light">
      <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width,initial-scale=1" />
        <title>Nature</title>
        <!-- Optional: place your Unsplash access key here to use the official API -->
        <!-- <meta name="unsplash-access-key" content="YOUR_UNSPLASH_ACCESS_KEY"> -->
        <link
          href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap"
          rel="stylesheet"
        />
        <script src="https://cdn.tailwindcss.com"></script>
        <script>
          tailwind.config = {
            darkMode: "class",
            theme: {
              extend: { fontFamily: { poppins: ["Poppins", "sans-serif"] } },
            },
          };
        </script>
        <style>
          html,
          body {
            height: 100%;
          }
          body {
            margin: 0;
            font-family: Poppins, sans-serif;
          }
          .bg-cover-center {
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
          }
          .overlay-light {
            background: rgba(255, 255, 255, 0.65);
          }
          .overlay-dark {
            background: rgba(8, 10, 12, 0.65);
          }
          .btn {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem 1rem;
            border-radius: 0.375rem;
            font-weight: 500;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1),
              0 4px 6px -2px rgba(0, 0, 0, 0.05);
          }
        </style>
      </head>
      <body
        class="min-h-screen flex items-center justify-center relative text-gray-900 dark:text-white"
      >
        <div id="bg" class="absolute inset-0 bg-cover-center"></div>
        <div id="overlay" class="absolute inset-0"></div>

        <main class="relative z-10 max-w-2xl w-full p-6 text-center">
          <h1 class="text-3xl md:text-5xl font-bold mb-4">
            Take a breath of nature
          </h1>
          <p class="text-sm md:text-base text-gray-700 dark:text-gray-200 mb-6">
            This background changes every time you open or refresh the page.
          </p>
          <div class="flex items-center justify-center gap-4">
            <button
              id="refresh"
              class="btn bg-white text-gray-900 hover:bg-gray-100 dark:bg-gray-800 dark:text-white dark:hover:bg-gray-700 transition"
            >
              Refresh
            </button>
            <button
              id="copy"
              class="btn bg-white text-gray-900 hover:bg-gray-100 dark:bg-gray-800 dark:text-white dark:hover:bg-gray-700 transition"
            >
              Copy image URL
            </button>
          </div>
          <p
            id="attribution"
            class="text-xs text-gray-600 dark:text-gray-300 mt-4"
          ></p>
        </main>

        <script>
          // This script will try to use the official Unsplash API when an access key
          // is provided (via meta tag or URL param). Otherwise it falls back to the
          // Unsplash Source endpoint which does not require a key.

          function getAccessKey() {
            // check meta tag
            const meta = document.querySelector(
              'meta[name="unsplash-access-key"]'
            );
            if (meta && meta.content) return meta.content.trim();

            // check url param unsplash_access_key or access_key
            try {
              const params = new URLSearchParams(window.location.search);
              const key =
                params.get("unsplash_access_key") || params.get("access_key");
              if (key) return key.trim();
            } catch (e) {
              // ignore
            }
            return null;
          }

          const FREE_SOURCES = [
            {
              name: "Picsum",
              fetch: () => {
                const seed = Math.floor(Math.random() * 1000);
                return {
                  url: `https://picsum.photos/seed/${seed}/1920/1080`,
                  credit: "Lorem Picsum",
                };
              },
            },
            {
              name: "PlaceIMG",
              fetch: () => ({
                url: "https://placeimg.com/1920/1080/nature",
                credit: "PlaceIMG",
              }),
            },
            {
              name: "Unsplash Source",
              fetch: (query) => {
                const ts = Date.now();
                return {
                  url: `https://source.unsplash.com/1920x1080/?${encodeURIComponent(
                    query
                  )}&${ts}`,
                  credit: "Unsplash",
                };
              },
            },
            {
              name: "Pexels Static",
              fetch: () => {
                const images = [
                  {
                    url: "https://images.pexels.com/photos/2014422/pexels-photo-2014422.jpeg",
                    credit: "JoÃ£o Jesus",
                  },
                  {
                    url: "https://images.pexels.com/photos/1761279/pexels-photo-1761279.jpeg",
                    credit: "Simon Berger",
                  },
                  {
                    url: "https://images.pexels.com/photos/1142941/pexels-photo-1142941.jpeg",
                    credit: "Jessica Lewis",
                  },
                  {
                    url: "https://images.pexels.com/photos/1770809/pexels-photo-1770809.jpeg",
                    credit: "Luis Dalvan",
                  },
                  {
                    url: "https://images.pexels.com/photos/1287075/pexels-photo-1287075.jpeg",
                    credit: "James Wheeler",
                  },
                ];
                const image = images[Math.floor(Math.random() * images.length)];
                return { ...image, credit: `${image.credit} (via Pexels)` };
              },
            },
          ];

          async function getRandomBackground(prefersDark) {
            // Try each source in order until one works
            for (const source of FREE_SOURCES) {
              try {
                console.log(`Trying ${source.name}...`);
                const result = source.fetch(
                  prefersDark ? "nature,night" : "nature"
                );
                if (result.url) {
                  // Test if image loads
                  await new Promise((resolve, reject) => {
                    const img = new Image();
                    img.onload = resolve;
                    img.onerror = reject;
                    img.src = result.url;
                  });
                  console.log(`${source.name} succeeded`);
                  return { ...result, source: source.name };
                }
              } catch (err) {
                console.warn(`${source.name} failed:`, err);
                continue;
              }
            }
            // All sources failed, return null to trigger SVG fallback
            return null;
          }

          async function applyBackground() {
            const prefersDark = window.matchMedia(
              "(prefers-color-scheme: dark)"
            ).matches;
            const bg = document.getElementById("bg");
            const overlay = document.getElementById("overlay");

            const result = await getRandomBackground(prefersDark);

            console.log("Background image result:", result);
            if (!result || !result.url) {
              const fallback =
                "data:image/svg+xml,%3Csvg xmlns=%22http://www.w3.org/2000/svg%22 width=%221920%22 height=%221080%22%3E%3Crect width=%22100%25%22 height=%22100%25%22 fill=%22%23cfe8d6%22/%3E%3Ctext x=%2250%25%22 y=%2250%25%22 dominant-baseline=%22middle%22 text-anchor=%22middle%22 font-size=%2230%22 fill=%22%23666%22%3EImage unavailable%3C/text%3E%3C/svg%3E";
              bg.style.backgroundImage = `url('${fallback}')`;
              overlay.className = prefersDark
                ? "overlay-dark absolute inset-0"
                : "overlay-light absolute inset-0";
              document.getElementById("attribution").textContent =
                "Image unavailable";
              window._lastImage = fallback;
              return;
            }

            bg.style.backgroundImage = `url('${result.url}')`;
            overlay.className = prefersDark
              ? "overlay-dark absolute inset-0"
              : "overlay-light absolute inset-0";
            document.getElementById("attribution").textContent =
              result.credit || "";
            window._lastImage = result.url;
          }

          async function init() {
            await applyBackground();

            document
              .getElementById("refresh")
              .addEventListener("click", async () => {
                await applyBackground();
              });

            document
              .getElementById("copy")
              .addEventListener("click", async () => {
                try {
                  await navigator.clipboard.writeText(window._lastImage || "");
                  const btn = document.getElementById("copy");
                  btn.textContent = "Copied!";
                  setTimeout(() => (btn.textContent = "Copy image URL"), 1500);
                } catch (e) {
                  alert("Copy failed: " + e.message);
                }
              });

            window
              .matchMedia("(prefers-color-scheme: dark)")
              .addEventListener("change", async () => {
                await applyBackground();
              });
          }

          document.addEventListener("DOMContentLoaded", init);
        </script>
      </body>
    </html>
  </head>
</html>
